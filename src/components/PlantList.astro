---
import { hc } from "hono/client";
import type app from "../app.ts";

const cookie = Astro.cookies.get("session")?.value!;
const url = new URL("/", Astro.request.url).toString();

const client = hc<typeof app>(url, {
  init: {
    credentials: "include",
    headers: {
      Cookie: `session=${cookie}`,
    },
  },
});

const req = await client.api.plants.$get();
const plants = (await req.json()) || [];
---

<div class="plant-list">
  {
    plants.length > 0 ? (
      <ul>
        {plants.map((plant) => (
          <li>
            <div class="plant-info">
              <span class="plant-name">{plant.name}</span>
              <span class="plant-id">#{plant.id}</span>
            </div>
            <form
              method="post"
              action={`/api/plants/${plant.id}/water`}
              class="water-form"
            >
              <button type="submit" class="water-button">
                ðŸ’§ Water
              </button>
            </form>
          </li>
        ))}
      </ul>
    ) : (
      <p class="no-plants">No plants yet. Add your first plant below!</p>
    )
  }
</div>

<style>
  .plant-list {
    margin-bottom: 40px;
  }

  .plant-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .plant-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    margin-bottom: 10px;
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
  }

  .plant-info {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .plant-name {
    font-weight: 500;
    color: #2d5f3f;
  }

  .plant-id {
    color: #6c757d;
    font-size: 0.9em;
  }

  .water-form {
    margin: 0;
  }

  .water-button {
    background-color: #4a90e2;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.9em;
    cursor: pointer;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .water-button:hover {
    background-color: #357abd;
  }

  .water-button:active {
    transform: translateY(1px);
  }

  .no-plants {
    text-align: center;
    color: #6c757d;
    font-style: italic;
    padding: 20px;
  }
</style>
