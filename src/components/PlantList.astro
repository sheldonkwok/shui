---
import { hc } from "hono/client";
import Plant from "./Plant.astro";
import type app from "../app.ts";

const cookie = Astro.cookies.get("session")?.value!;
const url = new URL("/", Astro.request.url).toString();

const client = hc<typeof app>(url, {
  init: {
    credentials: "include",
    headers: {
      Cookie: `session=${cookie}`,
    },
  },
});

const req = await client.api.plants.$get();
const data = (await req.json()) || [];
const plants = data.map((d) => ({
  ...d,
  lastWatered: d.lastWatered ? new Date(d.lastWatered) : null,
}));
---

<div class="plant-list">
  {
    plants.length > 0 ? (
      <ul>
        {plants.map((plant) => (
          <Plant plant={plant} />
        ))}
      </ul>
    ) : (
      <p class="no-plants">No plants yet. Add your first plant below!</p>
    )
  }
</div>

<style>
  .plant-list {
    margin-bottom: 40px;
  }

  .plant-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .no-plants {
    text-align: center;
    color: #6c757d;
    font-style: italic;
    padding: 20px;
  }
</style>
